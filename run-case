#!/bin/bash

# Declare the top-level directory and the program script.
projdir=~/sandbox/dmswarm-hybrid
runprog=${projdir}/run.sh

# Define the help text.
show_help() {
    printf "
This is a collection of aliases for ${runprog}.
Each case is keyed by a unique string. For example,

``$ ./run-case default``

is equivalent to

``$ cd ${projdir}``
``$ ./run.sh -Nx 8 -Ny 8 -Nz 8``
"
}

# Read CLI input.
name=
case "${1}" in
    -h | --help )
        show_help
        exit
        ;;
    * )
        name="${1}"
        ;;
esac

# Exit with an error if the user didn't provide a name.
if [ -z "${name}" ]; then
    echo "Got an empty name. Exiting."
    exit 1
fi

# Set up the mapping from name to function.
declare -A case_map

# Define the case functions.
run_default() {
    ./run.sh -Nx 8 -Ny 8 -Nz 8
}
case_map['default']=run_default
run_gamg_basic() {
    ./run.sh \
        -ksp_monitor_short \
        -ksp_type gmres \
        -ksp_max_it 100 \
        -pc_type gamg \
        -pc_gamg_type agg \
        -Nx 16 -Ny 16 -Nz 16 -n 2
}
case_map['gamg basic']=run_gamg_basic
case_map['gamg-basic']=run_gamg_basic
case_map['gamg_basic']=run_gamg_basic

# Run the case, if possible.
if [ -v case_map[${name}] ]; then
    pushd "${projdir}" &> /dev/null
    ${case_map[${name}]}
    popd &> /dev/null
else
    echo "Unknown case: \"${name}\""
    exit 1
fi

